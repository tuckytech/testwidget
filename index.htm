<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Widget Page</title>
  <script>
    // Listen for messages from the iframe
    window.addEventListener('message', (event) => {
      // Ensure there's a valid data structure
      if (!event.data || !event.data.WorkflowAPICall) return;

      // Parse the JSON payload from Bubble
      const eventDataParsed = JSON.parse(event.data.WorkflowAPICall);

      switch (eventDataParsed.endpoint) {
        case "open-widgetpopup":
          console.log("Entered case 'open-widgetpopup'");
          document.getElementById("widgetpopup").style.height = "100%";
          document.getElementById("widgetpopup").style.width = "100%";
          document.getElementById("widgetpopup").style.position = "fixed";
          document.getElementById("widgetpopup").style.left = "50%";
          document.getElementById("widgetpopup").style.top = "50%";
          document.getElementById("widgetpopup").style.transform = "translate(-50%, -50%)";
          document.getElementById("widgetpopup").style.backgroundColor = "rgba(0,0,0,.4)";
          document.getElementById("widgetpopup").style.zIndex = "9999999999999999";
          document.getElementById("widgetpopup").setAttribute("scrolling", "auto"); 
          break;

        case "close-popup":
          console.log("Entered case 'close-popup'");
          document.getElementById("widgetpopup").style.height = "476px";
          document.getElementById("widgetpopup").style.width = "400px";
          document.getElementById("widgetpopup").style.position = "relative";
          document.getElementById("widgetpopup").style.left = "inherit";
          document.getElementById("widgetpopup").style.top = "inherit";
          document.getElementById("widgetpopup").style.transform = "none";
          document.getElementById("widgetpopup").style.backgroundColor = "rgba(0,0,0,0)";
          document.getElementById("widgetpopup").style.zIndex = "1";
          document.getElementById("widgetpopup").setAttribute("scrolling", "no"); 
          break;
      }
    }, false);
  </script>
</head>
<body>
  <script type="text/javascript">
    // Dynamically build the iframe src with the parent's URL
    const url = parent.document.URL;
    document.write(
      '<iframe id="widgetpopup" ' +
        'style="margin: 0 auto; display: block;" ' +
        'src="https://greenthechain.com/version-test/widget2/1730179417198x962409578276585500?websiteSourceURL=' + url + '" ' +
        'width="400" ' +
        'height="476" ' +
        'frameborder="0" ' +
        'scrolling="no">' +
      '</iframe>'
    );
  </script>
</body>
</html>
